{
    "$schema": "http://json-schema.org/draft-04/schema",
    "type": "object" ,
    "title": "Kronos Results Format",
    "description": "The Kronos Results Format (KResults) is a standardised interchange format for timing output generated by the kronos-coordinator",
    "additionalProperties": false,
    "properties": {
        "version" : {
            "type": "number",
            "enum": [%(kronos-version)s],
            "description": "Version number of the KProfile format"
        },
        "tag": {
            "enum": ["%(kronos-magic)s"],
            "description": "Magic value to help test validity of KResults file"
        },
        "created": {
            "type": "string",
            "format": "date-time",
            "description": "A timestamp for creation of the KResults file"
        },
        "uid": {
            "type": "integer",
            "description": "The UID of the user who created this file"
        },
        "kronosVersion": {
            "type": "string",
            "description": "The version string for kronos"
        },
        "kronosSHA1": {
            "type": "string",
            "description": "The git SHA1 tag for the current build of kronos"
        },
        "appName": {
            "type": "string",
            "description": "The name of the application"
        },
        "appVersion": {
            "type": "string",
            "description": "The version string of the application"
        },
        "ranks": {
            "type": "array",
            "description": "Data is generated on each (MPI) process independently. The output from each rank is aggregated here.",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["host", "pid", "rank", "stats"],
                "properties": {
                    "host": {
                        "type": "string",
                        "description": "The hostname that the process is running on"
                    },
                    "pid": {
                        "type": "integer",
                        "minimum": 0,
                        "description": "The process ID of the generating process"
                    },
                    "rank": {
                        "type": "integer",
                        "minimum": 0,
                        "description": "The MPI rank of the generating process"
                    },
                    "stats": {
                        "type": "object",
                        "additionalProperties": false,
                        "patternProperties": {
                            "(read|write|mpi-collective|mpi-pairwise)": {
                                "type": "object",
                                "description": "Data logging for timed operations that involve moving data around",
                                "required": ["count", "bytes", "averageBytes", "sumSquaredBytes", "stddevBytes", "elapsed", "averageElapsed", "sumSquaredElapsed", "stddevElapsed"],
                                "properties": {
                                    "count": {
                                        "type": "integer",
                                        "description": "The number of logged events of this type",
                                        "minimum": 0
                                    },
                                    "bytes": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The total number of bytes transferred"
                                    },
                                    "averageBytes": {
                                        "type": "number",
                                        "minumum": 0,
                                        "description": "The average number of bytes transferred per logged event"
                                    },
                                    "sumSquaredBytes": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The sum of the squares of the number of bytes transferred per operation"
                                    },
                                    "stddevBytes": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The standard deviation of the number of bytes transferred per operation"
                                    },
                                    "elapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The total duration of the logged events"
                                    },
                                    "averageElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The average duration of the logged events"
                                    },
                                    "sumSquaredElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The sum of the squares of the durations of the logged events (used for calculating standard deviation)"
                                    },
                                    "stddevElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The standard deviation of the duration of the logged events"
                                    }
                                }
                            },
                            "(cpu|mkdir|rmdir|file-flush)": {
                                "type": "object",
                                "description": "Data logging for timed operations",
                                "required": ["count", "elapsed", "averageElapsed", "sumSquaredElapsed", "stddevElapsed"],
                                "properties": {
                                    "count": {
                                        "type": "integer",
                                        "description": "The number of logged events of this type",
                                        "minimum": 0
                                    },
                                    "elapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The total duration of the logged events"
                                    },
                                    "averageElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The average duration of the logged events"
                                    },
                                    "sumSquaredElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The sum of the squares of the durations of the logged events (used for calculating standard deviation)"
                                    },
                                    "stddevElapsed": {
                                        "type": "number",
                                        "minimum": 0,
                                        "description": "The standard deviation of the duration of the logged events"
                                    }
                                }
                            }

                        }
                    },
                    "time_series": {
                        "type": "object",
                        "description": "Time data from the kernels of the synthetic apps (per-process)",
                        "additionalProperties": false,
                        "patternProperties": {
                            "(n_write|n_read|bytes_write|bytes_read|n_pairwise|bytes_pairwise|n_collective|bytes_collective|flops|durations)": {
                                "type": "array",
                                "description": "data per kernel",
                                "items": {
                                    "type": "number"
                                }
                            }
                        }
                    }
                }
            }
        },
        "global": {
            "type": "object",
            "description": "Job-level statistics",
            "additionalProperties": false,
            "properties": {
                "stats": {
                    "type": "object",
                    "description": "Aggregated metrics",
                    "additionalProperties": {
                        "type": "number",
                        "description": "metric value"
                    }
                },
                "time_series": {
                    "type": "object",
                    "description": "Time data for the whole job",
                    "properties": {
                        "durations": {
                            "type": "array",
                            "description": "duration of the samples",
                            "items": {
                                "type": "number"
                            }
                        }
                    },
                    "additionalProperties": {
                        "type": "array",
                        "description": "data points",
                        "items": {
                            "type": "number"
                        }
                    }
                }
            }
        }
    },
    "required": ["version", "tag", "created"]
}
