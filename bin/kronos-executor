#!/usr/bin/env python

import json
import os
import sys

sys.path.append(os.path.dirname(os.path.dirname(__file__)))

from kronos.executor.executor import Executor
from kronos.io.schedule_format import ScheduleFormat


def usage():

    print "Usage:"
    print "    kronos-executor <config> <schedule>"
    print ""
    print "Config must be in JSON format. Schedule must be a KSF file output by Kronos"


if __name__ == "__main__":

    try:
        config_file = sys.argv[1]
        ksf_file = sys.argv[2]
    except IndexError:
        usage()
        sys.exit(-1)

    print "Configuration JSON: {}".format(config_file)
    print "Schedule (KSF): {}".format(ksf_file)

    with open(config_file, 'r') as f:
        config = json.load(f)

    with open(ksf_file, 'r') as f:
        schedule = ScheduleFormat.from_file(f)

    Executor(config, schedule, ksf_file=ksf_file).run()
